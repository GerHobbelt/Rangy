<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title></title>
    <style type="text/css">
        div.halfWidth {
            float: left;
            width: 48%;
            padding: 5px;
        }

        input.unapplied {
            border: solid #999 1px;
            background-color: #ccc;
        }

        input.applied {
            border: solid #999 1px;
            background-color: #eee;
        }
    </style>
    <script type="text/javascript" src="../lib/log4javascript.js"></script>
    <script type="text/javascript">
        var appender = new log4javascript.PopUpAppender();
        log4javascript.getRootLogger().addAppender(appender);
        log4javascript.setShowStackTraces(true);
        //log4javascript.setEnabled(false);
    </script>
    <script type="text/javascript" src="../src/js/core/core.js"></script>
    <script type="text/javascript" src="../src/js/core/dom.js"></script>
    <script type="text/javascript" src="../src/js/core/domrange.js"></script>
    <script type="text/javascript" src="../src/js/core/wrappedrange.js"></script>
    <script type="text/javascript" src="../src/js/core/wrappedselection.js"></script>
    <script type="text/javascript" src="../src/js/modules/rangy-commands.js"></script>
    <script type="text/javascript" src="../src/js/modules/commands/rangy-bold.js"></script>
    <script type="text/javascript" src="../src/js/modules/commands/rangy-italic.js"></script>
    <script type="text/javascript" src="../src/js/modules/commands/rangy-applyclass.js"></script>
    <script type="text/javascript" src="../src/js/modules/rangy-cssclassapplier.js"></script>
    <script type="text/javascript">
        var iframeDoc, iframeWin, contentHtmlTextArea, mainLoaded = false, iframeLoaded = false;
        var greenBorderCssClassApplier, boldRedCssClassApplier;

        function updateContentHtml() {
            contentHtmlTextArea.value = iframeDoc.body.innerHTML;
        }

        function allLoaded() {
            updateContentHtml();
        }

        // This is good enough for our target browsers
        function addEvent(obj, eventType, listener) {
            if (typeof obj.addEventListener != "undefined") {
                obj.addEventListener(eventType, listener, false);
            } else if (typeof obj.attachEvent != "undefined") {
                obj.attachEvent("on" + eventType, listener);
            }
        }

        window.onload = function() {
            rangy.init();
            iframeWin = rangy.dom.getIframeWindow( document.getElementById("content") );
            iframeDoc = iframeWin.document;
            contentHtmlTextArea = document.getElementById("contentHtml");
            mainLoaded = true;
            if (iframeLoaded) {
                allLoaded();
            }

            var timer = null;
            addEvent(iframeDoc, "keyup", function() {
                if (timer) {
                    window.clearTimeout(timer);
                }
                timer = window.setTimeout(function() {
                    timer = null;
                    updateContentHtml();
                }, 1000);
            });

            contentHtmlTextArea.onchange = function() {
                iframeDoc.body.innerHTML = contentHtmlTextArea.value;
            };

            greenBorderCssClassApplier = rangy.createCssClassApplier("greenBorder");
            boldRedCssClassApplier = rangy.createCssClassApplier("boldRed");
        };

        window.contentLoadCallback = function() {
            iframeLoaded = true;
            if (mainLoaded) {
                allLoaded();
            }
        };

        function execCommand(commandName, options) {
            options.document = iframeDoc;
            rangy.execCommand(commandName, options);

            updateContentHtml();
            iframeWin.focus();
        }

        var toolUpdaters = [];

        function createButton(text, commandName, options, updater) {
            var button = document.createElement("input");
            button.type = "button";
            button.value = text;
            button.className = "unapplied";
            button.onclick = function() {
                execCommand(commandName, options);
                if (updater) {
                    updater();
                }
            };
            document.getElementById("toolbar").appendChild(button);
        }

        function bold(styleWithCss, tagName) {
            rangy.execCommand("bold", {
                document: iframeDoc,
                styleWithCss: styleWithCss,
                tagName: tagName
            });

            updateContentHtml();
            iframeWin.focus();
        }

        function italic(styleWithCss) {
            rangy.execCommand("italic", {
                document: iframeDoc,
                styleWithCss: styleWithCss
            });

            updateContentHtml();
            iframeWin.focus();
        }

        function nativeBold() {
            iframeDoc.execCommand("bold", false, null);
            updateContentHtml();
            iframeWin.focus();
        }

        function applyClass(className) {
            rangy.execCommand("applyClass", {
                document: iframeDoc,
                value: className
            });

            updateContentHtml();
            iframeWin.focus();
        }

        function applyClassCssClassApplier(className) {
            var applier = (className == "boldRed") ? boldRedCssClassApplier : greenBorderCssClassApplier;
            applier.toggleSelection(iframeWin);
            updateContentHtml();
            iframeWin.focus();
        }
    </script>

</head>
<h1>Rangy commands demo</h1>
<p>
    Use the buttons to test the available commands. Both panes (WYSIWYG and HTML) are editable (HTML textarea uses
    <code>onchange</code>, so click outside or tab away to get the WYSIWYG pane to update).
</p>
<div class="halfWidth">
    WYSIWYG:
    <div style="border: solid gray 1px">
        <div style="background-color: #eee" id="toolbar">
            <input type="button" onclick="bold(true);" value="Bold/CSS">
            <input type="button" onclick="bold(false, 'b');" value="Bold/B">
            <input type="button" onclick="bold(false, 'strong');" value="Bold/strong">
            <input type="button" onclick="nativeBold();" value="Bold (native)">
            <input type="button" onclick="italic(true);" value="Italic/CSS">
            <input type="button" onclick="italic(false);" value="Italic">
            <input type="button" onclick="applyClass('greenBorder');" value="Green border">
            <input type="button" onclick="applyClass('boldRed');" value="Bold red">
            <input type="button" onclick="applyClassCssClassApplier('greenBorder');" value="Green border (CssClassApplier)">
            <input type="button" onclick="applyClassCssClassApplier('boldRed');" value="Bold red (CssClassApplier)">
        </div>
        <iframe id="content" src="content.html?1" style="width: 100%; height: 400px" frameborder="0"></iframe>
    </div>
</div>
<div class="halfWidth">
    HTML:
    <textarea style="width: 98%; height: 420px; font-size: 0.75em; font-family: Courier New, Monospace" id="contentHtml"></textarea>
</div>
<body>
</body>
</html>